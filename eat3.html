<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手機訂餐系統 / Mobile Ordering</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 600px; /* Adjust for typical mobile width */
            margin: 0 auto;
            padding: 16px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            background-color: #fff;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input[type="text"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 8px;
            width: 100%;
            box-sizing: border-box;
        }

        button:hover {
            background-color: #0056b3;
        }

        .menu-category {
            background-color: #fff;
            margin-bottom: 16px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .menu-category h2 {
            color: #333;
            margin-top: 0;
            margin-bottom: 12px;
            text-align: center;
        }

        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Responsive grid */
            gap: 10px;
        }

        .menu-items button {
            padding: 10px;
            background-color: #eee;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
        }

        .menu-items button:hover {
            background-color: #ddd;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8); /* Darker background for better focus */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10; /* Ensure it's on top */
        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-options > div {
            margin-bottom: 15px;
        }

        .modal-options label {
            margin-bottom: 5px;
        }

        .modal-options select {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .modal-content input[type="number"] {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
            margin-bottom: 15px;
        }

        .modal-content button {
            width: calc(50% - 10px);
            margin-right: 10px;
            margin-top: 15px;
            display: inline-block;
        }

        .modal-content button:last-child {
            margin-right: 0;
        }

        #orderList-container {
            background-color: #fff;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #orderList-container h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 12px;
        }

        .order-list {
            padding: 0;
            list-style-type: none;
        }

        .order-list li {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }

        .order-list li:last-child {
            border-bottom: none;
        }

        .order-list li button {
            background-color: #dc3545;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .order-list li button:hover {
            background-color: #c82333;
        }

        #orderResponse {
            color: green;
            text-align: center;
            margin-top: 15px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>手機訂餐系統</h1>

        <div class="form-group">
            <div>
                <label for="venueName">場地名稱: </label>
                <input type="text" id="venueName" placeholder="請輸入場地名稱">
            </div>
            <div>
                <label for="contactPhone">連絡電話: </label>
                <input type="text" id="contactPhone" placeholder="請輸入連絡電話">
            </div>
        </div>

        <div id="menu">
            </div>

        <div id="modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2 id="modal-title"></h2>
                <div id="modal-options">
                </div>
                <div style={{ marginBottom: "15px" }}>
                    <label for="quantity">數量: </label>
                    <input type="number" id="quantity" min="1" value="1">
                </div>
                <div>
                    <button onclick="closeModal()">取消</button>
                    <button onclick="addToOrders()">確定加入</button>
                </div>
            </div>
        </div>

        <div id="orderList-container">
            <h2>我的訂單</h2>
            <ul id="orderList" class="order-list">
                <li>目前沒有訂單</li>
            </ul>
        </div>

        <button onclick="submitOrders()">
            送出訂單
        </button>
        <p id="orderResponse" class="order-response"></p>
    </div>

    <script>
        const menu = {
            "飲料 / Drinks": [
                { name: "濃縮咖啡 / Espresso" },
                { name: "美式咖啡 / Americano" },
                { name: "拿鐵咖啡 / Latte" },
                { name: "榛果咖啡 / Hazelnut" },
                { name: "燕麥奶咖啡 / Oat Milk Coffee" },
                { name: "燕麥奶榛果咖啡 / Oat Milk Hazelnut Coffee" },
                { name: "紅茶 / Black Tea" },
                { name: "綠茶 / Green Tea" },
                { name: "烏龍茶 / Oolong Tea" },
                { name: "伯爵茶 / Earl Grey Tea" },
                { name: "奶茶 / Milk Tea" },
                { name: "檸檬紅茶 / Lemon Tea" },
                { name: "柚子茶 / Pomelo Tea" }
            ],
            "牛奶 / Milk & 燕麥奶 / Oat Milk": [
                { name: "牛奶 / Milk" },
                { name: "巧克力牛奶 / Chocolate Milk" },
                { name: "燕麥奶 / Oat Milk" }
            ],
            "果汁 / Juices": [
                { name: "柳橙汁 / Orange Juice" },
                { name: "蘋果汁 / Apple Juice" },
                { name: "檸檬汁 / Lemonade" }
            ],
            "罐裝飲料 / Soda": [
                { name: "可樂 / Coke" },
                { name: "雪碧 / Sprite" },
                { name: "運動飲料 / Sports Beverage" }
            ],
            "厚片吐司 / Thick Toast": [
                { name: "原味吐司 / Original Toast" },
                { name: "奶酥吐司 / Coconut Toast" },
                { name: "花生吐司 / Peanut Toast" },
                { name: "巧克力吐司 / Chocolate Toast" },
                { name: "蒜香吐司 / Garlic Toast" }
            ],
            "熱食 / Hot Meal": [
                { name: "肉包 / Pork Steamed Buns" },
                { name: "奶黃包 / Cream Bun" },
                { name: "燒賣 / Shaomai" },
                { name: "泡麵 / Instant Noodles" }
            ]
        };

        let venueName = "";
        let contactPhone = "";
        let orders = [];
        let selectedItem = null;
        let quantity = 1;
        let temp = "";
        let sweetness = "";
        let orderResponse = null;

        const venueNameInput = document.getElementById("venueName");
        const contactPhoneInput = document.getElementById("contactPhone");
        const menuDiv = document.getElementById("menu");
        const modalDiv = document.getElementById("modal");
        const modalTitle = document.getElementById("modal-title");
        const modalOptions = document.getElementById("modal-options");
        const quantityInput = document.getElementById("quantity");
        const orderListUl = document.getElementById("orderList");
        const orderResponseP = document.getElementById("orderResponse");

        venueNameInput.addEventListener("input", (e) => {
            venueName = e.target.value;
        });

        contactPhoneInput.addEventListener("input", (e) => {
            contactPhone = e.target.value;
        });

        quantityInput.addEventListener("input", (e) => {
            quantity = parseInt(e.target.value) || 1;
        });

        // 渲染菜單
        function renderMenu() {
            menuDiv.innerHTML = "";
            for (const category in menu) {
                const categoryDiv = document.createElement("div");
                categoryDiv.classList.add("menu-category");
                const categoryTitle = document.createElement("h2");
                categoryTitle.textContent = category.replace(" / ", "<br>"); // Break category name for better mobile view
                categoryTitle.style.whiteSpace = "normal";
                categoryDiv.appendChild(categoryTitle);
                const itemsDiv = document.createElement("div");
                itemsDiv.classList.add("menu-items");
                menu[category].forEach((item, index) => {
                    const itemButton = document.createElement("button");
                    itemButton.textContent = item.name.replace(" / ", "<br>"); // Break item name if needed
                    itemButton.style.whiteSpace = "normal";
                    itemButton.addEventListener("click", () => openModal(category, item));
                    itemsDiv.appendChild(itemButton);
                });
                categoryDiv.appendChild(itemsDiv);
                menuDiv.appendChild(categoryDiv);
            }
        }

        renderMenu();

        function openModal(category, item) {
            selectedItem = { category, name: item.name };
            quantity = 1;
            temp = "";
            sweetness = "";
            quantityInput.value = 1;
            modalTitle.textContent = item.name.replace(" / ", "<br>");
            modalTitle.style.whiteSpace = "normal";
            modalOptions.innerHTML = "";

            if (selectedItem.category === "飲料 / Drinks") {
                const tempDiv = document.createElement("div");
                tempDiv.style.marginBottom = "15px";
                const tempLabel = document.createElement("label");
                tempLabel.textContent = "冷/熱： ";
                const tempSelect = document.createElement("select");
                tempSelect.innerHTML = `
                    <option value="">請選擇</option>
                    <option value="冷">冷</option>
                    <option value="熱">熱</option>
                `;
                tempSelect.addEventListener("change", (e) => {
                    temp = e.target.value;
                });
                tempDiv.appendChild(tempLabel);
                tempDiv.appendChild(tempSelect);
                modalOptions.appendChild(tempDiv);

                const sweetnessDiv = document.createElement("div");
                sweetnessDiv.style.marginBottom = "15px";
                const sweetnessLabel = document.createElement("label");
                sweetnessLabel.textContent = "甜度： ";
                const sweetnessSelect = document.createElement("select");
                sweetnessSelect.innerHTML = `
                    <option value="">請選擇</option>
                    <option value="無糖">無糖</option>
                    <option value="半糖">半糖</option>
                    <option value="全糖">全糖</option>
                `;
                sweetnessSelect.addEventListener("change", (e) => {
                    sweetness = e.target.value;
                });
                sweetnessDiv.appendChild(sweetnessLabel);
                sweetnessDiv.appendChild(sweetnessSelect);
                modalOptions.appendChild(sweetnessDiv);
            }

            modalDiv.style.display = "flex";
        }

        function closeModal() {
            modalDiv.style.display = "none";
            selectedItem = null;
        }

        function addToOrders() {
            if (selectedItem.category === "飲料 / Drinks" && (!temp || !sweetness)) {
                alert("請選擇冷熱與甜度");
                return;
            }
            const orderItem = {
                ...selectedItem,
                quantity,
                temp: selectedItem.category === "飲料 / Drinks" ? temp : "",
                sweetness: selectedItem.category === "飲料 / Drinks" ? sweetness : ""
            };
            orders.push(orderItem);
            renderOrders();
            closeModal();
        }

        function removeOrder(index) {
            orders = orders.filter((_, i) => i !== index);
            renderOrders();
        }

        function renderOrders() {
            orderListUl.innerHTML = "";
            if (orders.length === 0) {
                const listItem = document.createElement("li");
                listItem.textContent = "目前沒有訂單";
                orderListUl.appendChild(listItem);
                return;
            }
            orders.forEach((order, index) => {
                const listItem = document.createElement("li");
                let itemDetails = `${order.name}`;
                if (order.category === "飲料 / Drinks") {
                    itemDetails += ` (${order.temp}, ${order.sweetness})`;
                }
                itemDetails += ` x ${order.quantity}`;
                listItem.textContent = itemDetails;
                const deleteButton = document.createElement("button");
                deleteButton.textContent = "刪除";
                deleteButton.addEventListener("click", () => removeOrder(index));
                listItem.appendChild(deleteButton);
                orderListUl.appendChild(listItem);
            });
        }

        renderOrders();

        async function submitOrders() {
            if (!venueName.trim() || !contactPhone.trim()) {
                alert("請先填寫場地名稱及連絡電話");
                return;
            }
            if (orders.length === 0) {
                alert("沒有訂單資料");
                return;
            }
            try {
                const payload = {
                    venueName,
                    contactPhone,
                    orders
                };
                const response = await fetch(
                    "https://script.google.com/macros/s/AKfycbwJ1bc9BuiIpAjL_cls2QobrRoUk3IPbmCnJMVhzfnYk8DsKBsm0GNdccyzITphX2BTmA/exec",
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    }
                );
                const result = await response.json();
                if (result.result === "success") {
                    orderResponseP.textContent = `訂單已成功送出，編號: ${result.orderId || '未知'}`;
                    orders = [];
                    renderOrders();
                } else {
                    alert("送出失敗: " + result.message);
                }
            } catch (error) {
                alert("送出訂單時發生錯誤: " + error.message);
            }
        }
    </script>
</body>
</html>
